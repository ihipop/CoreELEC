name: Build N1 Coreelec and Addon
on: 
  push:
    branches:
      - test

env:
  TZ: Asia/Shanghai
  DEBIAN_FRONTEND: noninteractive
  SSH_ACTIONS: false
  PROJECT: Amlogic
  ARCH: arm
  DEVICE: Phicomm-N1
  CUSTOM_VERSION: 9.2.4.2
jobs:
  make-image:
    name: Build Image
    runs-on: ubuntu-20.04
    if: github.event.repository.owner.id == github.event.sender.id
    
    steps:
    - name: checkout
      uses: actions/checkout@v2
      with:
        fetch-depth: 1
    - name: Initialization Environment
      run: |
        git branch -v
        sudo rm -rf /usr/share/dotnet /usr/local/lib/android /opt/ghc
        sudo -E apt-get -qq update
        sudo -E apt-get -qq install build-essential gcc make git unzip wget xz-utils patchutils gperf lzop xfonts-utils xsltproc libjson-perl
        sudo -E apt-get -qq autoremove --purge
        sudo -E apt-get -qq clean
        sudo timedatectl set-timezone "$TZ"
    - name: Show Disk Space
      run: |
        df -hT $PWD
    - name: SSH Connection To Actions
      uses: P3TERX/ssh2actions@main
      if: env.SSH_ACTIONS == 'true' || contains(github.event.action, 'ssh')
    - name: Download Tools
      run: |
        env
        tools/download-tool || tools/download-tool
      if: false
    - name: Make Image
      run: |
        env
        make image